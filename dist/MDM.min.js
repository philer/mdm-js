!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n(e.MDM=e.MDM||{})}(this,function(e){"use strict";function n(e,n){e in k?k[e].push(n):k[e]=[n]}function t(e,n){if(e in k)if(n)for(var t=k[e],r=0,i=t.length;i>r;++r){var o=t[r];if(o===n||o._fn===n){1===t.length?delete k[e]:t.splice(r,1);break}}else delete k[e]}function r(e,r){function i(e){t(e,i),r.call(this,e)}i._fn=r,n(e,i)}function i(e){for(var n,t=arguments.length,r=Array(t>1?t-1:0),i=1;t>i;i++)r[i-1]=arguments[i];if((n=console).log.apply(n,[e].concat(r)),e in k)for(var o=k[e].slice(),s=0,u=o.length;u>s;++s)o[s].apply(o,[e].concat(r))}function o(e,n){S[e]=n}function s(e){delete S[e]}function u(e){for(var n=arguments.length,t=Array(n>1?n-1:0),r=1;n>r;r++)t[r-1]=arguments[r];if(e in S){var o=S[e];if(s(e),!o.apply(C,[e].concat(t)))return}i.apply(C,[e].concat(t))}function c(){this._items=[],this._running=!1}function a(e,n){for(var t=0,r=n.length;r>t;++t)if(e(n[t]))return n[t]}function d(e,n,t,r){return t&&(m(t),r&&h(r)),A.user&&A.user===(e.id||e)||l(e),f(n)}function f(e){if(!e)return Promise.reject("Password required!");if(!A.user)return Promise.reject("Please chose a login name!");var n=M(A);return H.push(function(){var t=P.asyncToGenerator(regeneratorRuntime.mark(function r(t){var i,s,u;return regeneratorRuntime.wrap(function(r){for(;;)switch(r.prev=r.next){case 0:if(n.user===T.user&&L){r.next=3;break}return r.next=3,l(n.user);case 3:"session"in n&&n.session!==T.session&&(i=w(n.session),alert("SESSION###"+i.name+"###"+i.file)),"language"in n&&n.language!==T.language&&(s=g(n.language),alert("LANGUAGE###"+s.code)),u=void 0,o("error",function(e,n){return u=n}),o("passwordPrompt",function(){return t(u),!0}),L=!1,alert("LOGIN###"+e);case 10:case"end":return r.stop()}},r,this)}));return function(e){return t.apply(this,arguments)}}())}function l(e){return e=p(e),A.user=e.id,H.push(function(n){o("userSelected",function(){o("passwordPrompt",function(){return n(e),!0})}),alert("USER###"+e.name)})}function m(e){return e=w(e),A.session=e.id,i("sessionSelected",e),Promise.resolve(e)}function h(e){return e=g(e),A.language=e.id,i("languageSelected",e),Promise.resolve(e)}function p(e){return e=e.id||e,a(function(n){return n.id===e},E)}function w(e){return e=e.id||e,a(function(n){return n.id===e},R)}function g(e){return e=e.id||e,a(function(n){return n.id===e},U)}function _(){return alert("FORCE-SHUTDOWN###"),this}function v(){return alert("FORCE-RESTART###"),this}function y(){return alert("FORCE-SUSPEND###"),this}function b(){return alert("QUIT###"),this}var C,P={};P.asyncToGenerator=function(e){return function(){var n=e.apply(this,arguments);return new Promise(function(e,t){function r(i,o){try{var s=n[i](o),u=s.value}catch(c){return void t(c)}return s.done?void e(u):Promise.resolve(u).then(function(e){return r("next",e)},function(e){return r("throw",e)})}return r("next")})}},P.classCallCheck=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},P.createClass=function(){function e(e,n){for(var t=0;t<n.length;t++){var r=n[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(n,t,r){return t&&e(n.prototype,t),r&&e(n,r),n}}();var k=Object.create(null),S=Object.create(null),O=function(){function e(n,t,r,i){P.classCallCheck(this,e),this.id=n,this.name=n,this.gecos=t,this.loggedIn=r||!1,this.facefile=i||"file:///home/"+n+"/.face"}return P.createClass(e,[{key:"select",value:function(){return l(this),this}}]),e}(),x=function(){function e(n,t){P.classCallCheck(this,e),this.id=t,this.name=n,this.file=t}return P.createClass(e,[{key:"select",value:function(){return m(this),this}}]),e}(),j=function(){function e(n,t){P.classCallCheck(this,e),this.id=t,this.name=n,this.code=t}return P.createClass(e,[{key:"select",value:function(){return h(this),this}},{key:"countryCode",value:function(){return this.code.split(".")[0]}},{key:"shortCode",value:function(){return this.code.split("_")[0]}},{key:"charset",value:function(){return this.code.split(".")[1]}}]),e}();c.prototype={push:function(e){var n=this,t=new Promise(function(t,r){return n._items.push({callback:e,resolve:t,reject:r})});return this._start(),t},_start:function(){this._running||(this._running=!0,this._next())},_next:function(){if(!this._items.length)return void(this._running=!1);var e=this._items.shift(),n=this;new Promise(e.callback).then(function(){e.resolve.apply(e,arguments),n._next()},function(){e.reject.apply(e,arguments),n._next()})}};var E=[],R=[],U=[],A=Object.create(null),T=Object.create(null),H=new c,L=!1,M=function(e){return Object.assign(Object.create(Object.getPrototypeOf(e)),e)};window.mdm_add_user=function(e,n,t,r){var i=new O(e,n,t,r);E.push(i),u("userAdded",i)},window.mdm_add_session=function(e,n){var t=new x(e,n);R.push(t),u("sessionAdded",t)},window.mdm_add_language=function(e,n){var t=new j(e,n);U.push(t),u("languageAdded",t)},window.mdm_set_current_user=function(e){if(!e&&A.user)return o("usernamePrompt",function(){return!1}),o("prompt",function(){return!1}),void alert("USER###"+A.user);var n=p(e)||new O(e);T.user=n.id,u("userSelected",n)},window.mdm_set_current_session=function(e,n){var t=w(n)||new x(e,n);T.session=t.id,u("sessionSelected",t)},window.mdm_set_current_language=function(e,n){var t=g(n)||new j(e,n);T.language=t.id,u("languageSelected",t)},window.mdm_prompt=function(e){L=!1,u("prompt",e),u("usernamePrompt",e)},window.mdm_noecho=function(e){L=!0,u("prompt",e),u("passwordPrompt",e)},window.mdm_enable=function(){u("enabled")},window.mdm_disable=function(){u("disabled")},window.mdm_error=function(e){e&&u("error",e)},window.mdm_hide_shutdown=function(){i("shutdownHidden")},window.mdm_hide_restart=function(){i("restartHidden")},window.mdm_hide_suspend=function(){i("suspendHidden")},window.mdm_hide_quit=function(){i("quitHidden")},window.mdm_hide_xdmcp=function(){i("xdmcpHidden")},window.mdm_msg=function(e){e&&i("message",e)},window.mdm_timed=function(e){i("timedMessage",e),i("loginCountdown",+e.match(/[0-9]+/)[0])},window.set_welcome_message=function(e){e&&i("welcomeMessage",e)},window.set_clock=function(e){i("clockUpdate",e)},r("prompt",function(){return i("ready")}),e.addEventListener=n,e.on=n,e.removeEventListener=t,e.off=t,e.once=r,e.one=r,e.login=d,e.sendPassword=f,e.selectUser=l,e.selectSession=m,e.selectLanguage=h,e.getUser=p,e.getSession=w,e.getLanguage=g,e.shutdown=_,e.restart=v,e.suspend=y,e.quit=b});